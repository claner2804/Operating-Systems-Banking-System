Aufgabe
Es soll ein mehrbenutzerfähiges Bankingsystem entwickelt werden. Die Bank-Konten werden durch ein Array (mit 12 Einträgen) repräsentiert, welche in einem Shared-Memory Segment liegen. Ausserdem existieren mehrere Akteure (Prozesse), die Geld abheben oder einzahlen können. Der Zugriff auf die Bankaccounts muss mit Mutexen synchronisiert werden, sodass zu jedem Zeitpunkt nur ein Akteur Zugriff auf ein Konto hat.
Um die Lösung der Aufgabe zu erleichtern, haben wir im folgenden den Lösungsweg in viele einfach zu erledigende Einzelschritte unterteilt:
Legen Sie ein Shared-Memory Segment (ob Sie System-V oder POSIX Shared-Memory dafür verwenden, bleibt Ihnen überlassen) an. Wenn schon ein Shared-Memory Segment mit demselben Namen existiert, dann soll eine entsprechende Fehlermeldung auf stderr ausgegeben und das Programm beendet werden. In diesem Shared-Memory Segment soll das Array mit den Konten abgelegt werden.
Schreiben Sie eine Funktion clientAccessAccount(), die eine bestimme Geldsumme (wird als Parameter übergeben) von einem bestimmten Konto (wird auch als Parameter übergeben) abbucht oder hinzubucht (davon abhängig, ob die Geldsumme positiv oder negativ ist).
Schreiben Sie eine Funktion serverReadAccounts(), die den derzeitigen Kontostand aller Konten auf der Konsole ausgibt. Wenn ein Kontostand negativ ist, soll diese Funktion dem Konto automatisch einen Kredit gewähren (die Kreditsumme darf hardgecoded werden). Für jedes Konto soll die gesamte Kreditsumme (Summe aller individuellen Kredite) im Shared-Memory Segment abgespeichert werden.
Sorgen Sie dafür dass die Funktionen clientAccessAccount() und serverReadAccounts() synchroniziert sind, sodass nur jeweils ein Prozess zu jedem Zeitpunkt auf ein Konto zugreifen kann. Verwenden Sie dafür Mutexe.
Verwenden Sie alarm(3), um dafür zu sorgen, dass die Funktion serverReadAccounts() alle 3 Sekunden ausgeführt wird.
Zum Testen soll mithilfe von fork(3) mindestens vier Kindprozesse erzeugt werden, die alle in einer Endlos-Schleife die Funktion clientAccessAccount() ausführen. Auf was für ein Konto welche Geldsumme abgebucht oder hinzugebucht wird, soll mit Zufallszahlen gesteuert werden.
Schreiben Sie einen Signal-Handler, der dafür sorgt, dass sich beim Druck von STR+C das Programm beendet. Dabei sollen auch alle Client-Prozesse sauber beendet werden und vergessen Sie nicht, alle Resourcen wieder freizugeben.
Sorgen Sie bei allen Systemaufrufen für eine entsprechende Fehlerbehandlung und geben Sie im Bedarfsfall eine Fehlermeldung auf stderr aus.
